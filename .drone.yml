kind: pipeline
type: docker
name: default

steps:
- name: code-analysis
  image: aosapps/drone-sonar-plugin
  settings:
    sonar_host:
      from_secret: sonar_host
    sonar_token:
      from_secret: sonar_token
- name: test
  image: mjehanno/golang_gui:1.0.0
  commands:
  - apt-get install golang gcc libgl1-mesa-dev xorg-dev
  - go test ./...
- name: build
  image: mjehanno/golang_gui:1.0.0
  commands:
    - go build .
- name: package 
  image: mjehanno/golang_gui:1.0.0
  commands:
  - go install github.com/fyne-io/fyne-cross@latest
  - fyne-cross android -pull -app-id $APP_ID -icon $ICON_PATH
  - fyne-cross windows -pull -app-id $APP_ID -icon $ICON_PATH
  - fyne-cross linux -pull -app-id $APP_ID -icon $ICON_PATH
  - fyne-cross windows -pull -app-id $APP_ID -icon $ICON_PATH
  environment:
    APP_ID: com.mjehanno.dnd-spellcounter
    ICON_PATH: ./Icon.png
  when: 
    event:
    - tag
    
